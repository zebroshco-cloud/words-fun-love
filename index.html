<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Word | Built For You My Love /title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    .tile { aspect-ratio: 1/1; }
    .kb { user-select: none; }
  </style>
</head>
<body class="bg-white text-neutral-900">
  <div id="root"></div>

  <!-- NOTE: data-presets="react" ensures JSX compiles. -->
  <script type="text/babel" data-presets="react">
    const { useState, useEffect, useMemo } = React;

    // ---------- Word list (5 letters, uppercase) ----------
    const WORDS = [
      'CRANE','SLATE','POINT','BRAVE','CLOUD','SPICE','ROAST','TRAIL','PLANT','MARCH',
      'SHINE','GHOST','TIGER','MONEY','RAISE','FAITH','PRIDE','STORM','BREAD','LIGHT',
      'QUIET','HEART','FRAME','SOUND','SWEET','GRACE','WORLD','CHAIR','PLATE','SUGAR',
      'BLEND','WATER','STONE','RIVER','APPLE','GRAPE','BERRY','MANGO','LEMON','PEACH',
      'COAST','MET

    const DIFFICULTY = {
      Easy:   { maxGuesses: 7 },   // your request
      Medium: { maxGuesses: 3 }
    };

    const qwerty = [
      ['Q','W','E','R','T','Y','U','I','O','P'],
      ['A','S','D','F','G','H','J','K','L'],
      ['ENTER','Z','X','C','V','B','N','M','DEL']
    ];

    function pickAnswer(){ return WORDS[Math.floor(Math.random()*WORDS.length)]; }

    function scoreGuess(guess, answer){
      const A = answer.split('');
      const G = guess.toUpperCase().split('');
      const res = Array(5).fill('b');
      const counts = {};
      for (let ch of A) counts[ch] = (counts[ch]||0)+1;
      for (let i=0;i<5;i++){ if (G[i]===A[i]) { res[i]='g'; counts[G[i]]--; } }
      for (let i=0;i<5;i++){
        if (res[i]==='g') continue;
        const ch=G[i];
        if (counts[ch]>0){ res[i]='y'; counts[ch]--; }
      }
      return res; // g/y/b
    }

    function mergeKeyState(prev, guess, result){
      const rank = { b:0, y:1, g:2 };
      const next = { ...prev };
      for (let i=0;i<5;i++){
        const ch = guess[i].toUpperCase();
        const r = result[i];
        const cur = next[ch] || 'b';
        if (rank[r] > rank[cur]) next[ch] = r;
      }
      return next;
    }

    function App(){
      const [difficulty, setDifficulty] = useState('Easy');
      const [answer, setAnswer] = useState('');
      const [rows, setRows] = useState([]); // [{guess, result}]
      const [current, setCurrent] = useState('');
      const [keyState, setKeyState] = useState({});
      const [message, setMessage] = useState('');
      const [timeLeft, setTimeLeft] = useState(600); // 15 min
      const [running, setRunning] = useState(false);
      const [locked, setLocked] = useState(false);

      const maxGuesses = DIFFICULTY[difficulty].maxGuesses;

      function fmt(t){ const m=String(Math.floor(t/60)).padStart(2,'0'); const s=String(t%60).padStart(2,'0'); return `${m}:${s}`; }

      function startNewGame(){
        const a = pickAnswer();
        setAnswer(a);
        setRows([]);
        setCurrent('');
        setKeyState({});
        setMessage('');
        setTimeLeft(600);
        setRunning(true);
        setLocked(false);
      }

      // Auto-start on load (new word on refresh)
      useEffect(() => { startNewGame(); }, []);

      // Countdown
      useEffect(() => {
        if (!running || locked) return;
        const t = setInterval(() => setTimeLeft(x => {
          if (x<=1){ clearInterval(t); setLocked(true); setRunning(false); setMessage(`Time's up! The word was ${answer}.`); return 0; }
          return x-1;
        }), 1000);
        return () => clearInterval(t);
      }, [running, locked, answer]);

      function pushLetter(ch){ if (locked||!running) return; if (/^[A-Z]$/.test(ch) && current.length<5) setCurrent(p=>p+ch); }
      function popLetter(){ if (locked||!running) return; setCurrent(p=>p.slice(0,-1)); }

      function submit(){
        if (locked||!running) return;
        if (current.length!==5){ pulse('Enter a 5‚Äëletter word'); return; }
        const result = scoreGuess(current, answer);
        const win = result.every(x=>x==='g');
        const g = current.toUpperCase();
        setRows(prev=>[...prev, {guess:g, result}]);
        setKeyState(prev=>mergeKeyState(prev, g, result));
        setCurrent('');
        if (win){ setLocked(true); setRunning(false); setMessage('You did it. You are loved.  Smile Please'); return; }
        if (rows.length+1 >= maxGuesses){ setLocked(true); setRunning(false); setMessage(`Out of guesses. The word was ${answer}.`); }
      }

      function pulse(txt){ setMessage(txt); clearTimeout(pulse._t); pulse._t=setTimeout(()=>setMessage(''), 1300); }

      // Keyboard
      useEffect(() => {
        const onKey = (e) => {
          if (locked) return;
          const k = e.key;
          if (k==='Enter') return submit();
          if (k==='Backspace') return popLetter();
          if (/^[a-zA-Z]$/.test(k)) return pushLetter(k.toUpperCase());
        };
        window.addEventListener('keydown', onKey);
        return () => window.removeEventListener('keydown', onKey);
      }, [locked, current, rows, answer, running]);

      function keyBg(ch){ const m={b:'bg-neutral-200',y:'bg-yellow-300',g:'bg-green-500'}; return m[keyState[ch]||'b']; }

      function share(){
        const map={b:'‚¨õ',y:'üü®',g:'üü©'};
        const lines = rows.map(r=>r.result.map(x=>map[x]).join(''));
        const tries = rows.length <= maxGuesses ? rows.length : maxGuesses;
        const hdr = `Word Guess ‚Äî ${difficulty} ${rows.some(r=>r.result.every(x=>x==='g'))?tries:'X'}/${maxGuesses}  \n‚è± ${fmt(600-timeLeft)}`;
        const out = hdr + "\n" + lines.join('\n');
        navigator.clipboard.writeText(out).then(()=>pulse('Result copied!')).catch(()=>pulse('Copy failed'));
      }

      return (
        <div className="p-6 max-w-3xl mx-auto">
          <div className="flex items-center justify-between gap-3 flex-wrap">
            <div>
              <h1 className="text-2xl font-semibold">Word Guess</h1>
              <div className="text-sm text-neutral-500">5 letters ¬∑ {maxGuesses} guesses ¬∑ {difficulty}</div>
            </div>
            <div className="flex items-center gap-2">
              <div className="px-3 py-1 rounded border bg-white font-mono">‚è± {fmt(timeLeft)}</div>
              <select className="px-2 py-1 border rounded" value={difficulty} onChange={(e)=>setDifficulty(e.target.value)} disabled={rows.length>0}>
                <option>Easy</option>
                <option>Medium</option>
              </select>
              <button className="px-3 py-1 rounded border" onClick={startNewGame} disabled={running}>New Game</button>
              <button className="px-3 py-1 rounded border" onClick={share} disabled={rows.length===0}>Share</button>
            </div>
          </div>

          {message && (
            <div className="mt-3 p-2 rounded border bg-yellow-50 text-sm">{message}</div>
          )}

          {/* Grid */}
          <div className="mt-6 grid gap-2" style={{ gridTemplateRows: `repeat(${maxGuesses}, 1fr)` }}>
            {Array.from({length:maxGuesses}).map((_,rowIdx)=>{
              const row = rows[rowIdx];
              const isActive = rowIdx === rows.length;
              const text = row ? row.guess : (isActive? current : '');
              const result = row ? row.result : Array(5).fill('');
              return (
                <div key={rowIdx} className="grid grid-cols-5 gap-2">
                  {Array.from({length:5}).map((__,i)=>{
                    const letter = text[i]||'';
                    const r = result[i]||'';
                    const base = 'tile w-full border rounded flex items-center justify-center text-2xl font-bold';
                    const bg = r==='g'?'bg-green-500 text-white': r==='y'?'bg-yellow-400 text-white': r==='b'?'bg-neutral-300 text-white':'bg-white';
                    return <div key={i} className={`${base} ${bg}`}>{letter}</div>;
                  })}
                </div>
              );
            })}
          </div>

          {/* Keyboard */}
          <div className="mt-6 kb select-none">
            {qwerty.map((row,i)=> (
              <div key={i} className="flex justify-center gap-1 mb-1">
                {row.map(key => {
                  const wide = (key==='ENTER'||key==='DEL')?'px-3':'px-2';
                  const onClick = () => { if (key==='ENTER') submit(); else if (key==='DEL') popLetter(); else pushLetter(key); };
                  return (
                    <button key={key} className={`h-10 ${wide} rounded text-sm font-medium border ${key==='ENTER'||key==='DEL'?'bg-neutral-200':'bg-white'} ${key.length===1? keyBg(key):''}`} onClick={onClick} disabled={locked||!running}>{key}</button>
                  );
                })}
              </div>
            ))}
          </div>

          {/* Legend */}
          <div className="mt-6">
            <h3 className="text-sm uppercase tracking-wide text-neutral-500 mb-2">Legend</h3>
            <ul className="text-sm list-disc pl-5 space-y-1 text-neutral-700">
              <li><span className="font-medium">Colors:</span> üü© correct spot ¬∑ üü® in word, wrong spot ¬∑ ‚¨õ not in word</li>
              <li><span className="font-medium">Guesses:</span> Easy 7 ¬∑ Medium 3</li>
              <li><span className="font-medium">Timer:</span> 10:00 countdown; at 0:00 the round locks</li>
              <li><span className="font-medium">Refresh:</span> new game + new answer</li>
              <li><span className="font-medium">Controls:</span> Type letters; Enter to submit; Backspace to delete; on‚Äëscreen keyboard works too</li>
            </ul>
          </div>

          {/* Game over card */}
          {(locked && !running) && (
            <div className="mt-6 p-4 rounded-xl border bg-neutral-50">
              <div className="text-lg font-semibold mb-1">{rows.some(r=>r.result.every(x=>x==='g'))? 'You did it. You are loved.  Smile Please' : `Game over ‚Äî word was ${answer}.`}</div>
              <div className="flex gap-2 mt-2">
                <button className="px-3 py-1 rounded border" onClick={share} disabled={rows.length===0}>Copy Result</button>
                <button className="px-3 py-1 rounded border" onClick={startNewGame}>Play Again</button>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
